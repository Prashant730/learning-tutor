<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Call - AI Tutoring Tool</title>
  <link rel="stylesheet" href="styles.css">
  <script src="script.js" defer></script>
  <style>
    .video-container {
      height: calc(100vh - 8rem);
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .setup-screen, .call-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .call-screen {
      display: none;
    }

    .setup-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1rem;
      margin: 1rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .setup-title {
      font-size: 2rem;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
    }

    .setup-subtitle {
      color: #6b7280;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }

    .video-preview {
      width: 100%;
      max-width: 640px;
      aspect-ratio: 16 / 9;
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      border-radius: 1rem;
      overflow: hidden;
      position: relative;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 3px solid rgba(124, 58, 237, 0.3);
    }

    .video-preview video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
    }

    .video-placeholder svg {
      width: 4rem;
      height: 4rem;
      margin-bottom: 1rem;
      opacity: 0.7;
    }

    .video-controls {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 1rem;
      background: rgba(0, 0, 0, 0.7);
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      backdrop-filter: blur(10px);
    }

    .video-control-btn {
      width: 3rem;
      height: 3rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .video-control-btn:hover {
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .video-control-btn.active {
      background-color: #7c3aed;
      box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
    }

    .video-control-btn.disabled {
      background-color: #ef4444;
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
    }

    .setup-options {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .setup-options > div {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .call-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .call-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .call-badge {
      display: flex;
      align-items: center;
      padding: 0.4rem 0.8rem;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }

    .call-actions {
      display: flex;
      gap: 0.5rem;
    }

    .call-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      overflow-y: auto;
    }

    .participant {
      aspect-ratio: 16 / 9;
      background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
      border-radius: 1rem;
      overflow: hidden;
      position: relative;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(124, 58, 237, 0.3);
      transition: all 0.3s ease;
    }

    .participant:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(124, 58, 237, 0.4);
      border-color: rgba(124, 58, 237, 0.6);
    }

    .participant video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .participant-info {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 9999px;
      font-size: 0.875rem;
      color: white;
      backdrop-filter: blur(10px);
      font-weight: 500;
    }

    .participant-avatar {
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 9999px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.875rem;
      box-shadow: 0 2px 10px rgba(124, 58, 237, 0.5);
    }

    .participant-placeholder {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
    }

    .participant-placeholder .avatar {
      width: 5rem;
      height: 5rem;
      border-radius: 9999px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 2rem;
      color: white;
      margin-bottom: 1rem;
      box-shadow: 0 10px 30px rgba(124, 58, 237, 0.5);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 10px 30px rgba(124, 58, 237, 0.5);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 15px 40px rgba(124, 58, 237, 0.7);
      }
    }

    .call-footer {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      gap: 1rem;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    }

    .call-btn {
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 9999px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .call-btn::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 9999px;
      padding: 2px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .call-btn:hover::before {
      opacity: 1;
    }

    .call-btn:hover {
      transform: translateY(-3px);
    }

    .call-btn.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
    }

    .call-btn.primary:hover {
      box-shadow: 0 6px 20px rgba(124, 58, 237, 0.6);
    }

    .call-btn.secondary {
      background-color: #4b5563;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .call-btn.secondary:hover {
      background-color: #374151;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }

    .call-btn.danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
    }

    .call-btn.danger:hover {
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
    }

    .call-btn:active {
      transform: translateY(-1px);
    }

    .select-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 640px;
      margin-bottom: 1rem;
    }

    .select-label {
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #374151;
      font-size: 0.95rem;
    }

    .select-input {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background-color: white;
      color: #1f2937;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .select-input:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
    }

    .room-code-input {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background-color: white;
      color: #1f2937;
      width: 100%;
      max-width: 300px;
      font-size: 1rem;
      font-weight: 500;
      text-align: center;
      transition: all 0.3s ease;
    }

    .room-code-input:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
    }

    .name-input {
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      background-color: white;
      color: #1f2937;
      width: 100%;
      max-width: 640px;
      margin-bottom: 2rem;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .name-input:focus {
      outline: none;
      border-color: #7c3aed;
      box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
    }

    .session-ended {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 3rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1rem;
      margin: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .session-ended-icon {
      width: 6rem;
      height: 6rem;
      border-radius: 9999px;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ef4444;
      margin-bottom: 2rem;
      animation: pulse 2s infinite;
    }

    .session-ended-title {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .session-ended-subtitle {
      color: #6b7280;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }

    .session-duration {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
      color: #374151;
    }

    .session-thank-you {
      color: #6b7280;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }

    .copy-notification {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
      display: none;
      align-items: center;
      gap: 0.5rem;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .copy-notification.show {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">ðŸŽ“ AI Tutoring Tool</div>
      <nav class="nav">
        <a href="index.html" class="nav-link">Home</a>
        <a href="login.html" class="nav-link">Login</a>
        <a href="dashboard.html" class="nav-link">Dashboard</a>
        <a href="chat.html" class="nav-link">Chat</a>
        <a href="video.html" class="nav-link active">Video</a>
      </nav>
    </header>

    <!-- Video Container -->
    <div class="card video-container">
      <!-- Setup Screen -->
      <div id="setup-screen" class="setup-screen">
        <div class="setup-content">
          <h1 class="setup-title">Join Video Session</h1>
          <p class="setup-subtitle">Set up your audio and video before joining</p>

          <input type="text" id="user-name" class="name-input" placeholder="Enter your name" required>

          <div class="video-preview">
            <video id="local-video-preview" autoplay muted playsinline></video>
            <div class="video-placeholder">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-12 w-12 mb-2 opacity-50">
                <path d="m22 8-6 4 6 4V8Z"></path>
                <rect width="14" height="12" x="2" y="6" rx="2" ry="2"></rect>
              </svg>
              <p>Camera preview</p>
            </div>

            <div class="video-controls">
              <button id="mic-toggle" class="video-control-btn active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                  <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
                  <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                  <line x1="12" x2="12" y1="19" y2="22"></line>
                </svg>
              </button>
              <button id="camera-toggle" class="video-control-btn active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                  <path d="m22 8-6 4 6 4V8Z"></path>
                  <rect width="14" height="12" x="2" y="6" rx="2" ry="2"></rect>
                </svg>
              </button>
            </div>
          </div>

          <div class="select-container">
            <label for="camera-select" class="select-label">Camera</label>
            <select id="camera-select" class="select-input">
              <option value="">Select camera</option>
            </select>
          </div>

          <div class="select-container">
            <label for="mic-select" class="select-label">Microphone</label>
            <select id="mic-select" class="select-input">
              <option value="">Select microphone</option>
            </select>
          </div>

          <div class="setup-options">
            <div>
              <input type="text" id="room-code" class="room-code-input" placeholder="Enter room code (optional)">
              <button id="join-call-btn" class="btn btn-primary">Join Session</button>
            </div>
            <div>
              <button id="create-call-btn" class="btn btn-primary">Create Session</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Call Screen -->
      <div id="call-screen" class="call-screen">
        <div class="call-header">
          <div class="call-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-purple-400 mr-2">
              <path d="m22 8-6 4 6 4V8Z"></path>
              <rect width="14" height="12" x="2" y="6" rx="2" ry="2"></rect>
            </svg>
            <span class="font-medium">AI Tutoring Session</span>
            <div class="call-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3 mr-1">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span id="call-duration">00:00</span>
            </div>
            <div class="call-badge">
              <span>Room: </span>
              <span id="room-code-display">ABC123</span>
            </div>
          </div>
          <div class="call-actions">
            <button id="copy-room-code-btn" class="call-btn secondary" title="Copy room code">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
              </svg>
            </button>
          </div>
        </div>

        <div class="call-grid">
          <!-- Local participant -->
          <div class="participant">
            <video id="local-video" autoplay muted playsinline></video>
            <div class="participant-info">
              <div class="participant-avatar">Y</div>
              <span>You</span>
            </div>
          </div>

          <!-- Remote participant (placeholder) -->
          <div class="participant">
            <div class="participant-placeholder">
              <div class="avatar">T</div>
              <div class="font-medium">Dr. Smith</div>
              <div class="text-xs">Tutor</div>
            </div>
            <div class="participant-info">
              <div class="participant-avatar">T</div>
              <span>Dr. Smith</span>
            </div>
          </div>
        </div>

        <div class="call-footer">
          <button id="mic-btn" class="call-btn primary" title="Toggle microphone">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" x2="12" y1="19" y2="22"></line>
            </svg>
          </button>
          <button id="camera-btn" class="call-btn primary" title="Toggle camera">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <path d="m22 8-6 4 6 4V8Z"></path>
              <rect width="14" height="12" x="2" y="6" rx="2" ry="2"></rect>
            </svg>
          </button>
          <button id="screen-share-btn" class="call-btn primary" title="Share screen">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <rect width="20" height="14" x="2" y="3" rx="2"></rect>
              <line x1="8" x2="16" y1="21" y2="21"></line>
              <line x1="12" x2="12" y1="17" y2="21"></line>
            </svg>
          </button>
          <button id="hand-raise-btn" class="call-btn secondary" title="Raise hand">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"></path>
              <path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"></path>
              <path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path>
              <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path>
            </svg>
          </button>
          <button id="chat-btn" class="call-btn secondary" title="Chat">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </button>
          <button id="end-call-btn" class="call-btn danger" title="End call">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
              <path d="M16 2v4"></path>
              <path d="M8 2v4"></path>
              <path d="M15.5 13.5 8 6"></path>
              <path d="M16 22h4a2 2 0 0 0 2-2v-4"></path>
              <path d="M2 16v4a2 2 0 0 0 2 2h4"></path>
              <path d="M22 8V6a2 2 0 0 0-2-2h-4"></path>
              <path d="M2 8V6a2 2 0 0 1 2-2h4"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Session Ended Screen -->
      <div id="session-ended" class="session-ended">
        <div class="session-ended-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-12 w-12">
            <path d="M16 2v4"></path>
            <path d="M8 2v4"></path>
            <path d="M15.5 13.5 8 6"></path>
            <path d="M16 22h4a2 2 0 0 0 2-2v-4"></path>
            <path d="M2 16v4a2 2 0 0 0 2 2h4"></path>
            <path d="M22 8V6a2 2 0 0 0-2-2h-4"></path>
            <path d="M2 8V6a2 2 0 0 1 2-2h4"></path>
          </svg>
        </div>
        <h2 class="session-ended-title">Session Ended</h2>
        <p class="session-ended-subtitle">Your video session has ended</p>
        <p class="session-duration">Session duration: <span id="final-duration">00:15:30</span></p>
        <p class="session-thank-you">Thank you for using AI Tutoring Tool</p>
        <button id="new-session-btn" class="btn btn-primary">Start New Session</button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer py-4 border-t text-center">
      <p class="text-gray-500">
        &copy; <span id="current-year"></span> AI Tutoring Tool. All rights reserved.
        <script>document.getElementById('current-year').textContent = new Date().getFullYear();</script>
      </p>
    </footer>
  </div>

  <!-- Copy Notification -->
  <div id="copy-notification" class="copy-notification">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <span>Room code copied!</span>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const setupScreen = document.getElementById('setup-screen');
      const callScreen = document.getElementById('call-screen');
      const sessionEnded = document.getElementById('session-ended');
      const joinCallBtn = document.getElementById('join-call-btn');
      const createCallBtn = document.getElementById('create-call-btn');
      const endCallBtn = document.getElementById('end-call-btn');
      const newSessionBtn = document.getElementById('new-session-btn');
      const micToggle = document.getElementById('mic-toggle');
      const cameraToggle = document.getElementById('camera-toggle');
      const micBtn = document.getElementById('mic-btn');
      const cameraBtn = document.getElementById('camera-btn');
      const screenShareBtn = document.getElementById('screen-share-btn');
      const handRaiseBtn = document.getElementById('hand-raise-btn');
      const chatBtn = document.getElementById('chat-btn');
      const localVideoPreview = document.getElementById('local-video-preview');
      const localVideo = document.getElementById('local-video');
      const roomCodeInput = document.getElementById('room-code');
      const roomCodeDisplay = document.getElementById('room-code-display');
      const callDuration = document.getElementById('call-duration');
      const finalDuration = document.getElementById('final-duration');
      const cameraSelect = document.getElementById('camera-select');
      const micSelect = document.getElementById('mic-select');
      const copyRoomCodeBtn = document.getElementById('copy-room-code-btn');
      const copyNotification = document.getElementById('copy-notification');
      const userNameInput = document.getElementById('user-name');

      // State
      let stream = null;
      let durationInterval = null;
      let startTime = null;
      let isMicEnabled = true;
      let isCameraEnabled = true;
      let isScreenSharing = false;
      let isHandRaised = false;
      let isChatOpen = false;

      // Initialize media devices
      async function initializeDevices() {
        try {
          // Get list of media devices
          const devices = await navigator.mediaDevices.enumerateDevices();

          // Filter cameras and microphones
          const cameras = devices.filter(device => device.kind === 'videoinput');
          const mics = devices.filter(device => device.kind === 'audioinput');

          // Populate camera select
          cameraSelect.innerHTML = '<option value="">Select camera</option>';
          cameras.forEach(camera => {
            const option = document.createElement('option');
            option.value = camera.deviceId;
            option.text = camera.label || `Camera ${camera.deviceId.substring(0, 5)}...`;
            cameraSelect.appendChild(option);
          });

          // Populate mic select
          micSelect.innerHTML = '<option value="">Select microphone</option>';
          mics.forEach(mic => {
            const option = document.createElement('option');
            option.value = mic.deviceId;
            option.text = mic.label || `Microphone ${mic.deviceId.substring(0, 5)}...`;
            micSelect.appendChild(option);
          });

          // Start camera preview
          await startCameraPreview();
        } catch (err) {
          console.error('Error getting media devices:', err);
        }
      }

      // Start camera preview
      async function startCameraPreview() {
        try {
          // Request camera and microphone access
          stream = await navigator.mediaDevices.getUserMedia({
            audio: true,
            video: true
          });

          // Update video element
          localVideoPreview.srcObject = stream;

          // Update select values if labels are available
          const videoTrack = stream.getVideoTracks()[0];
          const audioTrack = stream.getAudioTracks()[0];

          if (videoTrack && videoTrack.label) {
            Array.from(cameraSelect.options).forEach(option => {
              if (option.text === videoTrack.label) {
                cameraSelect.value = option.value;
              }
            });
          }

          if (audioTrack && audioTrack.label) {
            Array.from(micSelect.options).forEach(option => {
              if (option.text === audioTrack.label) {
                micSelect.value = option.value;
              }
            });
          }
        } catch (err) {
          console.error('Error starting camera:', err);
        }
      }

      // Generate random room code
      function generateRoomCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < 6; i++) {
          result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
      }

      // Start call
      function startCall() {
        // Validate name
        if (!userNameInput.value.trim()) {
          alert('Please enter your name before joining');
          userNameInput.focus();
          return;
        }

        // Generate room code if not provided
        if (!roomCodeInput.value) {
          roomCodeInput.value = generateRoomCode();
        }

        // Display room code
        roomCodeDisplay.textContent = roomCodeInput.value;

        // Hide setup screen, show call screen
        setupScreen.style.display = 'none';
        callScreen.style.display = 'flex';
        sessionEnded.style.display = 'none';

        // Set local video
        localVideo.srcObject = stream;

        // Start duration timer
        startTime = new Date();
        durationInterval = setInterval(updateDuration, 1000);
      }

      // End call
      function endCall() {
        // Stop duration timer
        clearInterval(durationInterval);

        // Set final duration
        finalDuration.textContent = callDuration.textContent;

        // Hide call screen, show session ended
        callScreen.style.display = 'none';
        sessionEnded.style.display = 'flex';

        // Stop all tracks
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
        }
      }

      // Update call duration
      function updateDuration() {
        const now = new Date();
        const diff = now - startTime;
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        callDuration.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }

      // Toggle microphone
      function toggleMicrophone() {
        if (stream) {
          const audioTracks = stream.getAudioTracks();
          if (audioTracks.length > 0) {
            isMicEnabled = !isMicEnabled;
            audioTracks[0].enabled = isMicEnabled;

            // Update UI
            if (isMicEnabled) {
              micToggle.classList.add('active');
              micToggle.classList.remove('disabled');
              micBtn.classList.add('primary');
              micBtn.classList.remove('danger');
            } else {
              micToggle.classList.remove('active');
              micToggle.classList.add('disabled');
              micBtn.classList.remove('primary');
              micBtn.classList.add('danger');
            }
          }
        }
      }

      // Toggle camera
      function toggleCamera() {
        if (stream) {
          const videoTracks = stream.getVideoTracks();
          if (videoTracks.length > 0) {
            isCameraEnabled = !isCameraEnabled;
            videoTracks[0].enabled = isCameraEnabled;

            // Update UI
            if (isCameraEnabled) {
              cameraToggle.classList.add('active');
              cameraToggle.classList.remove('disabled');
              cameraBtn.classList.add('primary');
              cameraBtn.classList.remove('danger');
            } else {
              cameraToggle.classList.remove('active');
              cameraToggle.classList.add('disabled');
              cameraBtn.classList.remove('primary');
              cameraBtn.classList.add('danger');
            }
          }
        }
      }

      // Event Listeners
      joinCallBtn.addEventListener('click', startCall);
      createCallBtn.addEventListener('click', startCall);
      endCallBtn.addEventListener('click', endCall);
      newSessionBtn.addEventListener('click', function() {
        sessionEnded.style.display = 'none';
        setupScreen.style.display = 'flex';
        initializeDevices();
      });

      micToggle.addEventListener('click', toggleMicrophone);
      cameraToggle.addEventListener('click', toggleCamera);
      micBtn.addEventListener('click', toggleMicrophone);
      cameraBtn.addEventListener('click', toggleCamera);

      screenShareBtn.addEventListener('click', function() {
        isScreenSharing = !isScreenSharing;
        if (isScreenSharing) {
          screenShareBtn.classList.remove('primary');
          screenShareBtn.classList.add('danger');
        } else {
          screenShareBtn.classList.add('primary');
          screenShareBtn.classList.remove('danger');
        }
      });

      handRaiseBtn.addEventListener('click', function() {
        isHandRaised = !isHandRaised;
        if (isHandRaised) {
          handRaiseBtn.classList.remove('secondary');
          handRaiseBtn.classList.add('primary');
        } else {
          handRaiseBtn.classList.add('secondary');
          handRaiseBtn.classList.remove('primary');
        }
      });

      chatBtn.addEventListener('click', function() {
        isChatOpen = !isChatOpen;
        if (isChatOpen) {
          chatBtn.classList.remove('secondary');
          chatBtn.classList.add('primary');
          // In a real app, this would open a chat panel
          alert('Chat feature coming soon!');
        } else {
          chatBtn.classList.add('secondary');
          chatBtn.classList.remove('primary');
        }
      });

      // Copy room code
      copyRoomCodeBtn.addEventListener('click', function() {
        const roomCode = roomCodeDisplay.textContent;
        navigator.clipboard.writeText(roomCode).then(() => {
          // Show notification
          copyNotification.classList.add('show');
          setTimeout(() => {
            copyNotification.classList.remove('show');
          }, 2000);
        }).catch(err => {
          console.error('Failed to copy:', err);
          alert('Room code: ' + roomCode);
        });
      });

      // Change camera
      cameraSelect.addEventListener('change', async function() {
        if (this.value && stream) {
          try {
            const newStream = await navigator.mediaDevices.getUserMedia({
              video: { deviceId: { exact: this.value } },
              audio: true
            });

            // Stop old video track
            const oldVideoTrack = stream.getVideoTracks()[0];
            if (oldVideoTrack) {
              oldVideoTrack.stop();
            }

            // Replace video track
            const newVideoTrack = newStream.getVideoTracks()[0];
            stream.removeTrack(oldVideoTrack);
            stream.addTrack(newVideoTrack);

            // Update video elements
            localVideoPreview.srcObject = stream;
            if (localVideo.srcObject) {
              localVideo.srcObject = stream;
            }
          } catch (err) {
            console.error('Error changing camera:', err);
          }
        }
      });

      // Change microphone
      micSelect.addEventListener('change', async function() {
        if (this.value && stream) {
          try {
            const newStream = await navigator.mediaDevices.getUserMedia({
              video: true,
              audio: { deviceId: { exact: this.value } }
            });

            // Stop old audio track
            const oldAudioTrack = stream.getAudioTracks()[0];
            if (oldAudioTrack) {
              oldAudioTrack.stop();
            }

            // Replace audio track
            const newAudioTrack = newStream.getAudioTracks()[0];
            stream.removeTrack(oldAudioTrack);
            stream.addTrack(newAudioTrack);
          } catch (err) {
            console.error('Error changing microphone:', err);
          }
        }
      });

      // Initialize
      initializeDevices();
    });
  </script>
</body>
</html>
